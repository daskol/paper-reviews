# Rich feature hierarchies for accurate object detection and semantic segmentation

***Girshick R. et al, 2013***

Статья в большей степени является техническим отчётом группы, занимающейся
детектирование объектов на изображениях и семантической сегментации
изображений. Довольна старая работа, но в своё время это был успех, который
позволил выйти из короткого застоя в соревновании [PASCAL
VOC](http://host.robots.ox.ac.uk/pascal/VOC/). В основе лежат две ключевые
идеи: применение свёрточных сетей(CNN) вместо классического ансамблевого
подхода на основе SIFT и HOG; использование learning transfer для дообучения
AlexNet на картинках специфичных для области.

На момент написания статьи существует два подхода к детектированию объектов.
Первый интерпретирует задачу как задачу регрессии, но на тот момент показывает
неважные результаты по сравнению с CNN. Возможно, что на данные момент
появился какой-то прогресс, учитывая, что регрессия используется для улучшения
результатов во втором подходе. С другой стороны, можно классифицировать
объекты, которые попадают в некоторое скользящее окно. Идейно этот метод
развивается в статье. Регионы же для классификации пораждаются отдельным
инструментом и вносят довольную большую ошибку в локализацию объектов.

### Архитектура

Детектор состоит из трёх частей. Первая эмитирует регионы-кандидаты независимо
от категорий, с тем, чтобы в последнующем вычислить вероятность присутствия
объекта того или инога класс в области. Вторым элементом является свёрточная
сеть из AlexNet. Каждый регион расширяется на 16 пикселей и приводится к
размерности входа, несмотря на искажение картинки. На заключительной стадии
выполняется классификации по категориям двадцатью независимыми
классификаторами. Последнее кажется странным, ведь по крайней мере второй и
третий модуль можно обучать одновременно. Видимо дело в том, что тогда акцент
был смещён на том, что сети могут выучивать хороший признаки, а дальше
действуют по классике.

Первый модуль не является критической частью, а потом присутствует свобода
выбора. Авторы останавливаются на селективном поиске областей локализации из
работы
[Uijlings et al](https://link.springer.com/article/10.1007/s11263-013-0620-5),
чтобы можно было cравниться. Очень хочется избиться от такого модульного
подхода. Возможно, что сейчас здесь используется механизм внимания.

Также на третьей стадии используется жадная стратегия подавления
немаксимумов(non-maximum supression) для каждого класса в отдельности.
Отбрасыватся те рамки, которые имеют отношение пересечения к объединения(IoU) с
рамкой, которая имеет большую вероятность принадлежности к классу.

### Обучение

Первым делом дообучается свёрточная сеть на ILSVRC 2012 на целых картинках.

Следующим шагом сеть подстраивают под обрезанные регионы исходных изображений.
Причём голову исходной сети заменяют на голову с числом выходных нейронов `20 +
1`.  Получившуюся сеть обучаю градиентным спуском по батчу размера `128`,
состоящий из `32` положительных примеров и `96` отрицательных. Пример считется
пололжительным, если IoU с истинным регионом больше `0.5`.

После тонкой настройки весов свёрточной сети учатся бинарные классификаторы
классов.  Причём понятие положительного примера здесь уже зависит от
гиперпараметра -- порогового значения IoT, которое выбирается в пинтервале
`(0; 0.5)`. Далее, учится SVM с линейным ядром с учётом сильных отрицательных
примеров(hard negative mining).

### Обсуждение

При построении аналогичных систем рекоммендуется ознакомиться с
[устоявшейся практикой]
(https://link.springer.com/article/10.1007/s11263-009-0275-4) и валидировать
результаты на [VOC 2007](http://host.robots.ox.ac.uk/pascal/VOC/voc2007/).

Основная ошибка в детектирование вводится плохой локализацией региона. Эту
ошибку можно несколько компенсировать region regression, что даёт выигрыш в
несколько пунктов.

Как и ожидалось свёрточные слои учит сложные семантически сходные объекты.
Большие полносвязные слои несколько бесполезны, но для их использования
требуется тонка настройка на предлагаемый регионах.

Ну и конечно же, R-CNN превосходит все классические подходы к детектирования
объектов сцены.
